<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2025-12-06T16:16:11+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">JosephLee Blog</title><subtitle>Engineering Blog by Joseph Lee</subtitle><author><name>Joseph Lee</name></author><entry><title type="html">Event id 1074 on winsvr 2022 standard evaluation</title><link href="http://localhost:4000/Event-ID-1074-on-WinSvr-2022-Standard-Evaluation/" rel="alternate" type="text/html" title="Event id 1074 on winsvr 2022 standard evaluation" /><published>2025-12-06T00:00:00+09:00</published><updated>2025-12-06T00:00:00+09:00</updated><id>http://localhost:4000/Event%20ID%201074%20on%20WinSvr%202022%20Standard%20Evaluation</id><content type="html" xml:base="http://localhost:4000/Event-ID-1074-on-WinSvr-2022-Standard-Evaluation/"><![CDATA[<p>Related post:</p>
<ul>
  <li>https://velog.io/@leeyosebi/IIS-ARR-Configuration-with-ExSvr</li>
</ul>

<p>Well, Since I set up the ARR on IIS and ExSvr, the VM has been shuting down almost every hours. So the mail service can’t be last. and this is really annoying when I need to test. This post contains what I was trying to know what’s going on this.</p>

<p>Mail service is unavailable:
<img src="https://velog.velcdn.com/images/leeyosebi/post/4eebb8ba-7e76-431d-813b-221b74d6b77b/image.png" alt="" /></p>

<p>From the hyper-v host’s “Event Viewer → Applications and Services Logs → Microsoft → Windows → Hyper-V-Worker → Admin”, the server has been terminated. But no reason can be found.
<img src="https://velog.velcdn.com/images/leeyosebi/post/0024dbf7-86b5-4bfa-8ade-20b9c9464a00/image.png" alt="" /></p>

<p>Let’s moving forward to the VM’s event logs. I check the event viewer of the VM’s “Windows Logs &gt; System” and filter the events 1074 which can shows me the shuting down logs.
<img src="https://velog.velcdn.com/images/leeyosebi/post/1e961fda-aa50-4ff3-bd6b-d75985d91335/image.png" alt="" /></p>

<p>Error message:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The process C:\Windows\system32\wlms\wlms.exe (ALLDC01) has initiated the shutdown of computer ALLDC01 on behalf of user NT AUTHORITY\SYSTEM for the following reason: Other (Planned)
 Reason Code: 0x80000000
 Shutdown Type: shutdown
 Comment: The license period for this installation of Windows has expired. The operating system is shutting down.

</code></pre></div></div>

<p>Obviously, the message says the system has been shutdown this computer in the system context(NT AUTHORITY\SYSTEM) because of its OS license.
I’ve never seen this before..</p>

<p>Well, I have set this up with this ISO. It’s Standard Evaluation.
<img src="https://velog.velcdn.com/images/leeyosebi/post/12d53e18-a129-40fe-8737-f25986bb765a/image.png" alt="" /></p>

<p>In result, I found this is the originally architecture of the OS.
Referrence:</p>
<ul>
  <li>https://www.microsoft.com/en-us/evalcenter/evaluate-windows-server-2022</li>
  <li>https://woshub.com/stop-windows-auto-shutdown-every-hour/
<img src="https://velog.velcdn.com/images/leeyosebi/post/c69da4d5-bd93-49ab-adcf-a9f956d27762/image.png" alt="" /></li>
</ul>]]></content><author><name>Joseph Lee</name></author><summary type="html"><![CDATA[Related post: https://velog.io/@leeyosebi/IIS-ARR-Configuration-with-ExSvr]]></summary></entry><entry><title type="html">Iis arr configuration with exsvr</title><link href="http://localhost:4000/IIS-ARR-Configuration-with-ExSvr/" rel="alternate" type="text/html" title="Iis arr configuration with exsvr" /><published>2025-12-06T00:00:00+09:00</published><updated>2025-12-06T00:00:00+09:00</updated><id>http://localhost:4000/IIS%20ARR%20Configuration%20with%20ExSvr</id><content type="html" xml:base="http://localhost:4000/IIS-ARR-Configuration-with-ExSvr/"><![CDATA[<h1 id="overview">Overview</h1>
<p>For the exchange server, almote every clients will need to seperate the network traffic with 443 and 25.
In this case, they need reverse proxy. I will use IIS ARR(Application request routing) service as an proxy server.
So, here is the a diagram which shows you the architecture of the LAB for this post.</p>

<p><img src="https://velog.velcdn.com/images/leeyosebi/post/d5574dd0-1f1c-4a79-b3e2-99de7a7f8930/image.png" alt="" />
Make sure those server located in DMZ have to use two NIC obviously for the internet and private.</p>

<p>ref) 
Configuration IIS ARR for exchange server:</p>
<ul>
  <li>https://techcommunity.microsoft.com/blog/exchange/part-1-reverse-proxy-for-exchange-server-2013-using-iis-arr/592526</li>
  <li>https://www.youtube.com/watch?v=d6mqaHkGb-E</li>
</ul>

<h1 id="0-index">0. Index</h1>
<ol>
  <li>
    <p>IIS Proxy ARR
1.1 Basic settings
1.2 Server Farms
1.3 URL Rewrite rules</p>
  </li>
  <li>
    <p>Logs</p>
  </li>
  <li>
    <p>Warning</p>
  </li>
  <li>
    <p>Test</p>
  </li>
</ol>

<h1 id="1-iis-proxy-arr">1. IIS Proxy ARR</h1>
<p>I will skip the install steps..</p>
<h2 id="11-basic-settings">1.1 Basic settings</h2>

<p>First of all, we need to install the exchange server’s public ssl certificate on the ARR server.
And go to “IIS manager &gt; Sites &gt; Default Web Site &gt; Bindings &gt; https &gt; Edit”.
From here, you should assign the public ssl certificate with https.
<img src="https://velog.velcdn.com/images/leeyosebi/post/022605a2-dbb7-43e4-bc4e-1f0115e69542/image.png" alt="" /></p>

<p>Second, Go to the Home &gt; Application Request Routing Cache.
<img src="https://velog.velcdn.com/images/leeyosebi/post/3fadf0f4-8371-4f52-afde-73a62a01f900/image.png" alt="" />
go to server proxy settings.
<img src="https://velog.velcdn.com/images/leeyosebi/post/af6b625b-cfc0-4913-adc9-b72cbf3f225c/image.png" alt="" />
Check “Enable proxy”.
<img src="https://velog.velcdn.com/images/leeyosebi/post/c950b2c9-487d-4ec8-9349-53574ee0e012/image.png" alt="" /></p>

<p>and lastly, create new server farms.</p>

<h2 id="12-server-farms">1.2 Server Farms</h2>
<p>Once you created the server farms, you have few options there.
<img src="https://velog.velcdn.com/images/leeyosebi/post/e07244f1-e34d-4290-8f7c-e2ff7a256303/image.png" alt="" /></p>

<ul>
  <li>
    <p>Caching, uncheck “Enable disk cache” and apply.
<img src="https://velog.velcdn.com/images/leeyosebi/post/590289e9-0f64-4dba-9092-428986797109/image.png" alt="" /></p>
  </li>
  <li>
    <p>Health Test, enter your external exchange server https://FQDN/owa/healthcheck.htm
<img src="https://velog.velcdn.com/images/leeyosebi/post/a1a1e079-184b-4f6b-8dbb-bca632bcc861/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/18dd9014-7682-4516-92c9-f3aa516e2451/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/ba37bb41-369a-4dc0-b46e-65145223efb2/image.png" alt="" /></p>
  </li>
  <li>
    <p>Monitoring and Management, once your health test have passed, your server will be available and Healthy.
<img src="https://velog.velcdn.com/images/leeyosebi/post/081cb61f-2423-48f6-8d53-8e89f1f6c910/image.png" alt="" /></p>
  </li>
  <li>
    <p>Proxy, Set as following image.
<img src="https://velog.velcdn.com/images/leeyosebi/post/fce50836-6914-43b6-bc75-f8dbad8ede8f/image.png" alt="" /></p>
  </li>
  <li>
    <p>Routing Rules, uncheck both options.
<img src="https://velog.velcdn.com/images/leeyosebi/post/0d05596d-22ec-4889-a743-f2b35258f155/image.png" alt="" /></p>
  </li>
</ul>

<h2 id="13-url-rewrite-rules">1.3 URL Rewrite rules</h2>
<p>Now, this is the important part in the whole configuration.</p>

<p>From the Routing rules in the server farms, go to URL Rewrite.
<img src="https://velog.velcdn.com/images/leeyosebi/post/2bc0d813-fa66-4c5b-bc76-aa389a65b713/image.png" alt="" /></p>

<p>I already add the URL Rewrite rule here. Let’s take a look for the details.
<img src="https://velog.velcdn.com/images/leeyosebi/post/ccbef07d-1448-4408-b1bc-f5d74c0eb716/image.png" alt="" /></p>

<p>If the request URL matches <em>(all urls), check the two conditions: is it https? and is the host matches with the pattern(</em>.all.run.place)?
<img src="https://velog.velcdn.com/images/leeyosebi/post/21a64581-95d2-43ad-a0b8-628a14e41408/image.png" alt="" /></p>

<p>If the prerequisites meets, the requests are redirected to the server farm with the https.
<img src="https://velog.velcdn.com/images/leeyosebi/post/6a45ca6b-37c1-41fa-b7ce-8b6418274c09/image.png" alt="" /></p>

<h1 id="2-logs">2. Logs</h1>
<p>All the logs are in this path:</p>
<ul>
  <li>C:\inethub\logs\LogFiles\W3SVC1</li>
</ul>

<p>e.g.
<img src="https://velog.velcdn.com/images/leeyosebi/post/ddf1fb97-4ed3-4993-8bdf-62d5be0831a7/image.png" alt="" /></p>

<h1 id="3-warning">3. Warning</h1>
<p>If the inbound rule is not match exactly with the requested URL, you will encounter 500 error like below.
This is quite tricky if you address this kind of LB.</p>

<p><img src="https://velog.velcdn.com/images/leeyosebi/post/bd29df82-0c2f-4516-81af-b3f61ca98e77/image.png" alt="" /></p>

<h1 id="4-test">4. Test</h1>

<p>Do the test for the exchange server services.</p>

<p>https://testconnectivity.microsoft.com/tests/exchange</p>

<p><img src="https://velog.velcdn.com/images/leeyosebi/post/9d8f849a-66dd-4043-99f6-7a5d99e893a5/image.png" alt="" /></p>

<h1 id="result">Result</h1>
<p>This is so customisable so it’s too difficult to handle…
Good luck.</p>]]></content><author><name>Joseph Lee</name></author><summary type="html"><![CDATA[Overview For the exchange server, almote every clients will need to seperate the network traffic with 443 and 25. In this case, they need reverse proxy. I will use IIS ARR(Application request routing) service as an proxy server. So, here is the a diagram which shows you the architecture of the LAB for this post.]]></summary></entry></feed>