<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.27.3 by Michael Rose
  Copyright 2013-2025 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->

<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Multiple domain support for federating with microsoft entra id - eeLhpesoJ - Engineering blog</title>
<meta name="description" content="0. Index">


  <meta name="author" content="Joseph Lee">
  
  <meta property="article:author" content="Joseph Lee">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en">
<meta property="og:site_name" content="eeLhpesoJ - Engineering blog">
<meta property="og:title" content="Multiple domain support for federating with microsoft entra id">
<meta property="og:url" content="http://localhost:4000/Multiple-Domain-Support-for-Federating-with-Microsoft-Entra-ID/">


  <meta property="og:description" content="0. Index">







  <meta property="article:published_time" content="2025-03-26T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/Multiple-Domain-Support-for-Federating-with-Microsoft-Entra-ID/">












<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="eeLhpesoJ - Engineering blog Feed">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
  window.enable_copy_code_button = true;
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@latest/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96" />
<!-- end custom head snippets -->

  </head>

  <body class="layout--single" dir="ltr">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          eeLhpesoJ - Engineering blog
          
        </a>
        <ul class="visible-links"></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      




  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/" itemprop="item"><span itemprop="name">Home</span></a>

          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Multiple domain support for federating with microsoft entra id</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/favicon/favicon-96x96.png" alt="Joseph Lee" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Joseph Lee</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>A full-stack engineering mindset</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Seoul, Korea</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/eelhpesoj/eelhpesoj.github.io" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/joseph-lee-870660260/" rel="nofollow noopener noreferrer me" itemprop="sameAs"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="mailto:leeyosebi@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Contact Me: Joseph Lee</span></a></li>
          
        
          
            <li><a href="mailto:dobineer@gmail.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Request Us: Engineering team</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Multiple domain support for federating with microsoft entra id">
    <meta itemprop="description" content="0. Index">
    <meta itemprop="datePublished" content="2025-03-26T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">
            <a href="http://localhost:4000/Multiple-Domain-Support-for-Federating-with-Microsoft-Entra-ID/" itemprop="url">Multiple domain support for federating with microsoft entra id
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-03-26T00:00:00+09:00">March 26, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-list"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#0-index">0. Index</a></li><li><a href="#1-lab-configuration">1. LAB Configuration</a></li><li><a href="#2-enable--supportmultipledomain">2. Enable -SupportMultipleDomain</a></li><li><a href="#3-enrollment-custom-domain-name">3. Enrollment Custom Domain Name</a></li><li><a href="#4-deployment-second-top-level-domain-with-entra-id-connect">4. Deployment Second Top-Level Domain with Entra ID Connect</a></li><li><a href="#5-hotcakekrokr-user-sync">5. â€˜@hotcake.kro.krâ€™ user sync</a></li><li><a href="#6-validation">6. Validation</a></li><li><a href="#7-ref">7. Ref</a></li><li><a href="#8-issue-msonline-module-retirement">8. Issue: MSOnline Module Retirement</a></li></ul>
            </nav>
          </aside>
        
        <h1 id="0-index">0. Index</h1>

<p>When configuring a hybrid environment, the authentication method for users is also set up through AADC. However, only one authentication method (PHS, PTA, or ADFS) can be selected per forest.</p>

<p>Now, my customer has configured ADFS authentication to allow their headquarters employees to access the M365 environment. However, their branch employees are also in the same forest, and they need access to M365 as well. Since they are in the same forest, they must also authenticate via ADFS.</p>

<p>Is this possible? Letâ€™s find out.</p>

<h1 id="1-lab-configuration">1. LAB Configuration</h1>
<p>First up first, I have two domains here.</p>
<ul>
  <li>thecake.kro.kr(Federated)</li>
  <li>hotcake.kro.kr</li>
</ul>

<p>The users whose upn suffix is thecake.kro.kr and hotcake.kro.kr is in the DC(the cake.kro.local). And I synced @thecake.kro.kr users with ADFS authentication in AADC.</p>

<p>And Iâ€™m gonna deploy @hotcake.kro.kr users to current ADFS authentication process.</p>

<p><img src="https://velog.velcdn.com/images/leeyosebi/post/7bdd0a06-fee7-4224-8212-17a0d9af2eba/image.png" alt="" /></p>

<h1 id="2-enable--supportmultipledomain">2. Enable -SupportMultipleDomain</h1>
<p>First, go to your ADFS server. And execute the commands below.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Connect-MsolService
Set-MsolADFSContext <span class="nt">-Computer</span> <span class="s2">"thecakeadfs.thecake.kro.local"</span>
Update-MsolFederatedDomain <span class="nt">-DomainName</span> thecake.kro.kr <span class="nt">-SupportMultipleDomain</span>
</code></pre></div></div>
<p><img src="https://velog.velcdn.com/images/leeyosebi/post/d72129c8-e4df-407a-88f9-dcd0df10ba02/image.png" alt="" /></p>

<h1 id="3-enrollment-custom-domain-name">3. Enrollment Custom Domain Name</h1>
<p>Go to your tenant. Enroll and verify your new Top-Level Domain.
<img src="https://velog.velcdn.com/images/leeyosebi/post/c60ba582-cad5-4dba-9dbe-ea90be49ab72/image.png" alt="" /></p>

<h1 id="4-deployment-second-top-level-domain-with-entra-id-connect">4. Deployment Second Top-Level Domain with Entra ID Connect</h1>
<p>Go to your AADC and federate your new doamin.
Click â€˜Manage federationâ€™
<img src="https://velog.velcdn.com/images/leeyosebi/post/c66332be-e37e-4510-8b10-58ac370b615c/image.png" alt="" />
Click â€˜Federate Microsoft Entra ID domainâ€™.
<img src="https://velog.velcdn.com/images/leeyosebi/post/7caa414f-b126-4e97-8586-03d14c27f09e/image.png" alt="" />
To federate your new domain, you should be identified tenant administrator and ADFS server administrator.
<img src="https://velog.velcdn.com/images/leeyosebi/post/6ad3be70-6d41-4ef6-a1f3-55994b015823/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/1ad26f03-e284-44f8-b62c-33a48438ade5/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/afa18f49-a46e-40d3-a4e3-00851aacaa39/image.png" alt="" />
Now, select your new domain that will be federated. If the domain is not visible, you should go tenant and make your new domain verified.
<img src="https://velog.velcdn.com/images/leeyosebi/post/2f7044e9-9aaa-4447-9284-7cbc127a2635/image.png" alt="" />
Click â€˜Nextâ€™ to update ADFS relying party trust.
<img src="https://velog.velcdn.com/images/leeyosebi/post/c3277ea6-b7f4-4f37-a16b-5c03c7f08cd2/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/2713d9cc-e676-4f22-9447-0f411edca29c/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/b4ca2ed5-480b-4a1d-8489-7e80c200609d/image.png" alt="" /></p>

<p>Just let AADC do the work. Once it successfully deployed, you will see the original domain and your new domain displayed with check icon on the Federated collumn.
<img src="https://velog.velcdn.com/images/leeyosebi/post/5bec3da6-44c2-408c-9cf9-cf04c7df4df8/image.png" alt="" />
And also, you can check</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MsolDomain
</code></pre></div></div>
<p><img src="https://velog.velcdn.com/images/leeyosebi/post/ee295ee8-5242-43d0-8c23-cc2a577c892e/image.png" alt="" />
Also use</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MsolDomainFederationSettings <span class="nt">-DomainName</span> thecake.kro.kr<span class="s1">'
</span></code></pre></div></div>
<p>Note the IssuerUri.
<img src="https://velog.velcdn.com/images/leeyosebi/post/790bcb6a-1880-4c0a-b395-4ca4fa4ac5ae/image.png" alt="" />
Use</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Get-MsolDomainFederationSettings <span class="nt">-DomainName</span> hotcake.kro.kr<span class="s1">'
</span></code></pre></div></div>
<p>The IssuerUri is different from Original Domain. But the other URL that used for the ADFS authentication is the same.
<img src="https://velog.velcdn.com/images/leeyosebi/post/50810448-e7dc-4a68-ae77-dd2f88286c68/image.png" alt="" /></p>

<h1 id="5-hotcakekrokr-user-sync">5. â€˜@hotcake.kro.krâ€™ user sync</h1>
<p>Okay, we are good to go for the @hotcake.kro.kr users to sync M365 environment.
<img src="https://velog.velcdn.com/images/leeyosebi/post/0679f5ab-4eed-466d-9a08-49822701bd9a/image.png" alt="" /></p>

<h1 id="6-validation">6. Validation</h1>
<p>After synchronisation, both domain users redirected to the ADFS server.
@thecake.kro.kr users.
<img src="https://velog.velcdn.com/images/leeyosebi/post/50d0d3c8-ae30-426c-9825-febef77dda4c/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/49372d62-3db7-47d1-aff2-afa91dff9968/image.png" alt="" />
@hotcake.kro.kr users.
<img src="https://velog.velcdn.com/images/leeyosebi/post/e08e3bb7-ba25-44f2-8412-9e2099828dc1/image.png" alt="" />
<img src="https://velog.velcdn.com/images/leeyosebi/post/b7b71cac-492e-40ef-948c-1d85d010281e/image.png" alt="" /></p>

<p>Obviously, they are success in authentication so that they can use M365 services.
<img src="https://velog.velcdn.com/images/leeyosebi/post/a7b416ac-2238-4550-92f4-7a045a49fd70/image.png" alt="" /></p>

<h1 id="7-ref">7. Ref</h1>
<p>Following documents are exactly refering the same content execept the Module.
First one uses MSOnline and second one uses Graph. But graph module and its command in the document has been deprecated.</p>
<ul>
  <li>https://docs.azure.cn/en-us/entra/identity/hybrid/connect/how-to-connect-install-multiple-domains</li>
  <li>https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-multiple-domains</li>
  <li>https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-install-multiple-domains</li>
</ul>

<h1 id="8-issue-msonline-module-retirement">8. Issue: MSOnline Module Retirement</h1>
<p>However, MSOnline module also will be retirement soon.
I have no idea whatâ€™s going on this add new Top-Level domain scenario..
https://techcommunity.microsoft.com/blog/microsoft-entra-blog/action-required-msonline-and-azuread-powershell-retirementâ€”2025-info-and-resou/4364991</p>

<p><img src="https://velog.velcdn.com/images/leeyosebi/post/62ae3adf-f8c0-4001-bfdb-913f1d7aba82/image.png" alt="" /></p>


        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2025-03-26T00:00:00+09:00">March 26, 2025</time></p>

      </footer>

      

      
  <nav class="pagination">
    
      <a href="/Registration-Java-App-in-Entra-ID/" class="pagination--pager" title="Registration java app in entra id">Previous</a>
    
    
      <a href="/Create-and-Publish-PowerShell-Module/" class="pagination--pager" title="Create and publish powershell module">Next</a>
    
  </nav>


    </div>

    
      
        <p>
          Comments are configured with provider: <strong>utterances</strong>,
          but are disabled in non-production environments.
        </p>
      
    
  </article>

  
  
    
<div class="page__related">
  
  <h2 class="page__related-title">You may also enjoy</h2>
  <div class="grid__wrapper">
    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/IIS-ARR-Configuration-with-ExSvr/" rel="permalink">Iis arr configuration with exsvr
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-12-06T00:00:00+09:00">December 6, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
For the exchange server, almote every clients will need to seperate the network traffic with 443 and 25.
In this case, they need reverse proxy. I wi...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Event-ID-1074-on-WinSvr-2022-Standard-Evaluation/" rel="permalink">Event id 1074 on winsvr 2022 standard evaluation
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-12-06T00:00:00+09:00">December 6, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Related post:

  https://velog.io/@leeyosebi/IIS-ARR-Configuration-with-ExSvr

</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Checking-Public-SSL-Certificate/" rel="permalink">Checking public ssl certificate
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-11-15T00:00:00+09:00">November 15, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
Most of the cases, we need to check the ssl stream if the connection is funtioning properly or not.
To do this, I suggest the two options below.
In ...</p>
  </article>
</div>

    
      
      



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/Exchange-Hybrid-EWS-Dedicated-Hybrid-app/" rel="permalink">[exchange hybrid] ews â†’ dedicated hybrid app
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2025-09-18T00:00:00+09:00">September 18, 2025</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          2 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Overview
Dear all, this post will provide you an idea to go through retirement of EWS from exchange online. All of this content from refer following two docu...</p>
  </article>
</div>

    
  </div>
</div>

  
  
</div>

      
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2025 <a href="https://eelhpesoj.github.io">Joseph Lee</a>. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/jekyll-themes/minimal-mistakes/" rel="nofollow">Minimal Mistakes</a>.</div>


         <a href='http://www.freevisitorcounters.com'>free counters</a> <script type='text/javascript' src='https://www.freevisitorcounters.com/auth.php?id=66402066087668e96703a2b922d7eb610db76c45'></script>
<script type="text/javascript" src="https://www.freevisitorcounters.com/en/home/counter/1455696/t/5"></script>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'eelhpesoj/eelhpesoj.github.io');
    script.setAttribute('issue-term', 'pathname');
    script.setAttribute('label', 'ðŸ’¬ comment');
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





    
  </body>
</html>
